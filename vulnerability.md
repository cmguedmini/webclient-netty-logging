import org.springframework.expression.AccessException;
import org.springframework.expression.EvaluationException;
import org.springframework.expression.TypeLocator;
import java.util.Collections;
import java.util.List;

/**
 * Impl√©mentation de TypeLocator qui bloque toute tentative de r√©solution de classe.
 * Ceci est la d√©fense primaire contre l'injection de code (RCE) via SpEL.
 */
class NoClassResolver implements TypeLocator {
    
    /**
     * Bloque T(fqcn)
     */
    @Override
    public Class<?> findType(String typeName) throws EvaluationException {
        // Bloque toute tentative de trouver une classe (ex: T(java.lang.Runtime))
        throw new AccessException("Class resolution is strictly forbidden for security reasons.");
    }
    
    /**
     * Retourne une liste vide pour les pr√©fixes d'importation.
     */
    @Override
    public List<String> getImportPrefixes() {
        return Collections.emptyList();
    }
}

----------------------------
import org.springframework.expression.spel.standard.SpelExpressionParser;
import org.springframework.expression.spel.support.StandardEvaluationContext;
import org.springframework.expression.Expression;
import org.springframework.expression.ExpressionParser;
import org.springframework.expression.EvaluationContext;

// ... Votre code de classe ...

String spelString = featureSpelMap.get(featureId);

// 1. Initialiser le contexte d'√©valuation standard
StandardEvaluationContext evaluationContext = new StandardEvaluationContext(featureContext);

// 2. üö® S√âCURISATION CRUCIALE : Remplacer le TypeLocator par notre impl√©mentation qui bloque la r√©solution de classe
// Cela emp√™che l'ex√©cution de code arbitraire via T(fqcn).
evaluationContext.setTypeLocator(new NoClassResolver());

// 3. (Optionnel mais recommand√©) Configurer un BeanResolver si n√©cessaire.
// Si vous n'utilisez pas de beans Spring dans vos expressions SpEL, cela d√©sactive l'acc√®s aux beans.
// Si vous utilisez des beans, assurez-vous de limiter la visibilit√©.
// evaluationContext.setBeanResolver(null); 

ExpressionParser parser = new SpelExpressionParser();
Expression exp = parser.parseExpression(spelString);

// L'√©valuation est maintenant s√©curis√©e contre les injections de code SpEL RCE de base
return exp.getValue(evaluationContext, type);
